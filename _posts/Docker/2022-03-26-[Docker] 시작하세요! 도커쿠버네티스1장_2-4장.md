---

layout: post
title: "[Docker] 시작하세요! 도커쿠버네티스 1장~2-4장"
subtitle: "시작하세요! 도커쿠버네티스1장_2-4장"
categories: study
tags: Docker
---

> 시작하세요! 도커/쿠버네티스 1장 ~ 2.4장 정리

# 1장. 도커란?

## 1.1 가상머신 & 도커 컨테이너

![Container&VM](https://d1.awsstatic.com/Developer%20Marketing/containers/monolith_2-VM-vs-Containers.78f841efba175556d82f64d1779eb8b725de398d.png)

가상머신

- 완벽한 운영체제를 생성할 수 있음
- 일반 호스트에 비해 성능 손실 발생, 배포 부담

도커 컨테이너

- 리눅스의 chroot, 네임스페이스, cgroup 사용 → 프로세스 단위의 격리 환경
- 호스트 커널 공유해서 사용
- 배포 시간이 가상머신보다 빠름

## 1.2 도커를 시작해야 하는 이유

- 애플리케이션의 개발과 배포가 편해짐
- 여러 애플리케이션의 독립성과 확장성이 높아짐

## 1.3 도커 엔진 설치

도커 엔진은 EE(Enterprise Edition) / CE(Community Edition) 존재

### docker-machine & Virtualbox 통해 docker 설치

- virtualbox 설치 : `brew install virtualbox --cask `

- docker-machine 설치 : `brew install docker-machine --formula`

- docker-machine 생성 : `docker-machine create --driver [virtualbox/...등의 driver] [name]`

  - Virtual box 기본적으로 linux OS로 docker 실행 가능한 VM이 실행됨

- Docker host 설정 : `docker-machine env [name]`

- Virtual box instance ssh 접속

  ```shell
  docker-machine ssh default
  ```

# 2장. 도커엔진

## 2.1 도커 이미지 & 컨테이너

도커 엔진에서 사용하는 기본 단위, 핵심

### 2.1.1 도커 이미지

- 여러 계층으로 된 바이너리 파일
- 컨테이너를 생성/실행할 때 읽기 전용으로 사용됨

- [저장소 이름]/[이미지 이름]/[태그]

### 2.1.2 도커 컨테이너

- 독립된 파일시스템, 호스트와 분리
- 이미지를 통해 생성되는 격리된 공간

## 2.2 도커 컨테이너 다루기

### 2.2.1 컨테이너

`docker run` : 컨테이너를 생성 후 실행

- 컨테이너 내부 접속 후 
  - Ctrl + d : 컨테이너 종료
  - Ctrl + p,q : 컨테이너 셸 접속에서만 나옴
- 옵션
  - -d : Detached 모드
  - -e : 컨테이너 내부의 환경변수 설정
  - --link : 컨테이너 간 연결. alias로 접근.
    - --link [연결하고자 하는 컨테이너명]:[alias]
    - docker exec [container name] curl [alias]:[port] --silent
    - ❗️유의할 점❗️ 컨테이너가 실행 중이지 않거나 존재하지 않는다면 --link를 적용한 컨테이너 또한 실행할 수 없음
    - deprecated 옵션

`docker pull` : 이미지 가져오기

`docker images` : 이미지 조회

`docker attach` : 컨테이너 내부로 들어감

`docker rm` : 컨테이너 삭제

`docker container prune` : 모든 컨테이너 삭제

`docker run -p 옵션` : 컨테이너 외부에 노출

`docker port [container name]` : 호스트와 바인딩된 포트 조회

- eg) docker run -p 3306:3306 -p 192.168.0.100:7777:80 ubuntu



도커에서는 <u>한 컨테이너에 프로세스 하나만 실행</u>하는 것이 권장됨.

### 2.2.6 도커 볼륨

컨테이너 삭제 시 컨테이너의 파일도 같이 날라감. 이를 보존하기 위한 방법 3가지 존재

1. 호스트와 볼륨 공유
   - docker run의 `-v` 옵션 : -v [호스트의 공유 디렉터리]:[컨테이너의 공유 디렉터리]
   - 동기화 ❌ 동일한 디렉터리 ⭕️
   - 단일 파일 단위 공유도 가능
   - 여러 개의 -v 옵션 사용 가능
   - 호스트 볼륨 공유는 호스트의 디렉터리를 컨테이너 디렉터리에 마운트 → 컨테이너의 디렉터리가 덮어싀워짐
2. 볼륨 컨테이너 활용
   - -v 옵션으로 볼륨을 사용하는 컨테이너를 다른 컨테이너와 공유
3. 도커가 관리하는 볼륨 생성

### 2.2.7.2 도커 네트워크 기능

• 도커 자체 제공 네트워크 드라이버 : 브릿지, 호스트, none, 컨테이너, 오버레이
• 서드파티 플러그인 솔루션 : weave, flannel, openvswitch

`docker network`
• docker network [connect/disconnect] [네트워크 명] [컨테이너 명]: 컨테이너에 네트워크를 유동적으로 붙이고 뗄 수 있음
	◦ 브리지, 오버레이 네트워크와 같이 특정 IP대역을갖는 네트워크 모드에만 사용 가능

#### 브리지 네트워크
docker0이 아닌 사용자 정의 브리지를 새로 생성해 각 컨테이너에 연결하는 네트워크 구조
• 브리지 네트워크 생성 : docker network create —driver bridge mybridge
• —net 옵션 : 컨테이너가 지정한 네트워크를 사용하도록 설정
	◦ docker run -it —name mynetwork_container —net mybridge ubuntu

#### 호스트 네트워크
호스트의 네트워크 환경을 그대로 사용
별도의 생성 필요 없이, —net 옵션에서 사용
• docker run -it —name network_host —net host ubuntu

#### 논 네트워크
아무런 네트워크를 쓰지 않는 것. 외부와 연결 단절

#### 컨테이너 네트워크
다른 컨테이너의 네트워크 네임스페이스 환경 공유
• 공유되는 속성 : 내부 IP, 네트워크 인터페이스의 MAC 주소 등
• —net container:[다른 컨테이너 ID]
• 내부 ip 새로 할당받지 않으며 호스트에 veth로 시작하는 가상 네트워크 인터페이스도 생성 X.

### 2.2.9 컨테이너 자원 할당 제한

아무런 옵션을 입력하지 않으면 컨테이너는 호스트 자원 무제한 사용

`docker update (변경할 자원 제한) (컨테이너 이름)`

#### 2.2.9.1 컨테이너 메모리 제한

- docker run -d `--memory="1g"`
  - 입력 단위 : m(메가바이트), g(기가바이트)
  - 최소 메모리 : 4MB
- 컨테이너 할당 메모리 초과시 자동으로 컨테이너는 종료됨
- 스왑 메모리 설정
  - docker run -it --momory=200m `--memory-swap=500m` ubuntu
  - 컨테이너의 스왑 메모리 default : 메모리의 2배

#### 2.2.9.2 컨테이너 CPU 제한

`--cpu-shares`

-  docker run -it --name cpu_share `--cpu-shares 1024` ubuntu
- cpu-shares 값은 상대적인 값
- 컨테이너에 가충지를 설정해 해당 컨테이너가 <u>CPU를 상대적으로 얼마나 사용</u>할 수 있는지 표기

`--cpuset-cpu`

- 