---
layout: post
title: "[Network] 네트워크 Day-2"
subtitle: "패킷 & IP Address"
categories: study
tags: network
---

-------------------------------------------------------
복습
-------------------------------------------------------
OSI 7 Layer
 - Transport (4 Layer) : TCP, UDP
 - Network (3) : IP, IPX, ...  ; 라우터
 - Data link(2) : ; NIC(랜카드), 스위치, 브리지; Mac 주소로 통신
	- MAC 주소 : 각 랜카드 고유 식별 번호. 48bit.  앞에 3번째 부터 22bit는 회사. 뒤 24bit는 회사 내 할당 번호.
	- 랜카드는 모든 통신을 받고 mac 주소 비교해 CPU로 넘길지 판단.
 - Physical(1) : ; Hub
	- Hub에 연결되어 있는 장비에 flooding

**Data Encapsulation**
 - 데이터 보내는 쪽에서 데이터 처리 과정
 - Transport (4 Layer) : 데이터 한 단위를 `Segment`라고 칭함; TCP/UDP 정보 header에 추가.
 - Network (3 Layer) : `Packet`이라고 칭함;
 - Data link (2) : `Frame`; Mac address; ARP 프로토콜 통해 브로드캐스트를 통해 목적지의 해당 mac 주소를 얻어옴.
 - Physical (1) : `Bits`'; 2진법으로 데이터 변환  


@ ARP ?
 - Address Resolution Protocol
 - 네트워크 상에서 IP 주소를 물리적 네트워크 주소(MAC)로 대으이키기 위해 사용되는 프로토콜.

**De-Encapsulation**
 - 데이터 받는 쪽에서 데이터를 다시 재조립하는 과정

-------------------------------------------------------

# 패킷 전달과 IP Address


## 패킷 송/수신 절차의 이해
## IPv4 주소(Address) 구조
## 브로드캐스트(Broadcast) 구조
## 서브네팅(SubNetting)의 의미와 필요성


## 패킷 송/수신 절차의 이해
1. Unicast
  1) 특정 목적지의 주소(MAC address) 하나만을 가지고 통신하는 방식
  2) 1 대 1 통신 방식


2. Broadcast
  1) 로컬 랜에 붙어 있는 모든 네트워크 장비들에게 보내는 통신
	@ 로컬 랜 : 라우터에 의해서 구분된 공간, 즉 브로드캐스트 도메인이라고 하는 공간
  2) Router 인터페이스(Broadcast Domain) 하위에 있는 모든 네트워크 장비에 메세지를 보냄
  3) Broadcast ip


3. Mulicast
  1) 특정 그룹 데이터를 보내는 경우 적당한 방법으로 유니캐스트와 브로드캐스트의 장점을 겹합해서 한 번에 그룹 멤버들에게 다 보내면서도 그룹 멤버 이외의 PC에는 영향을 주지 않음
  2) 스위치나 라우터가 멀티캐스트 기능을 지원해야만 가능
  3) D 클래스 ip 사용

@ IP 종류
 1. unicast ip
 2. broadcast ip
 3. mulicast ip


Mac Address Components
 - 48bit 데이터를 16진수(0~9 + A~F)로 표현
 - 첫번째 bit : broadcast인지 아닌지, 두 번째도 뭔가 정보
 - 22 bit : 제조사 번호
 - 중복되지 않는 고유 번호


```
cmd 실행
> ipconfig/all
````
 - ipconfig/all : IP 구성 조회 명령어
 - 물리적 주소 (Physical Adress) : 자신의 맥 어드레스


## IPv4 주소(Address) 구조

IP Address 
 - 목적지 시스템을 식별하기 위한 주소체계
 - A, B, C 클래스
 - IANA 에서 관리 ---> ISP : 인터넷 서비스 업체
 - v4 : 32bit (약 43억개 ip)
 - v6 : 128bit (약 340 언데시릴온(10^36))   

| 버전 | bit | ?? |
|---|---|---|
| v4 | 32 | 4 옥텟 |
| v6 | 128 |  |

@옥텟?
 - 1옥텟= 8bit

@ bit ?
 - 1 bit : 2^1
 - 2 bit : 2^2
 ...
 - 32 bit : 2^32 = 4,294,967,296‬


| 클래스 | ip고정(앞에서부터) | 목적 |
|:---:|---|---|
|A Class| 0 (첫번째는 0으로 고정) | 목적지 식별 |
|  | 000000000.00000000.00000000.00000000 | 1.0.0.0  |
|  | 01111111.11111111.11111111.11111111 | 126.255.255.255 |
|  | Network.Host.Host.Host| |
|  | Network 수 : 2^7 - 2 (126) , Host 수 : 2^24 -2 (16,777,214)| |
|B Class| 10 | 목적지 식별 |
|  | 100000000.00000000.00000000.00000000 | 128.0.0.0  |
|  | 10111111.11111111.11111111.11111111 | 191.255.255.255 |
|  | Network.Network.Host.Host| |
|  | Network 수 : 2^14 (16,384) , Host 수 : 2^16 -2 (65,534)| |
|C Class| 110 | 목적지 식별 |
|  | 110000000.00000000.00000000.00000000 | 192.0.0.0  |
|  | 11011111.11111111.11111111.11111111 | 223.255.255.255 |
|  | Network.Network.Network.Host| |
|  | Network 수 : 2^21 (2,097,152) , Host 수 : 2^8 -2 (254)| |
|D Class| 1110 | 멀티캐스트 |
|  |  | 224.0.0.0 ~ 239.255.255.255  |
|E Class| 0 | 예약, 군사용 |
|  |  | 240.0.0.0 ~ 255.255.255.255  |

- 목적지 식별 위한 class는 C 클래스 까지
- D 클래스는 Multicast를 위해 사용
- E 클래스 : 예약
- ip 클래스는 맨 앞 수만 봐서 식별 가능.

Network ID : Network 식별 (서브넷), <우편번호>, <라우터>, ISP에서 할당
Host ID : Host 식별 , <번지>, <각 node>,  <네트워크 관리자>
	- host에 모든 bit가 0, 1인 아이피는 쓰면 안됨.(예약 ip)
LoopBack IP : 모든 시스템에서 서버 서비스를 테스트할 목적으로 적용된 IP (127.X.X.X)
	랜카드 까지 갔다가 다시 돌아옴.



**Public IP (공인 IP)**
 - IANA에서 관리
 - 인터넷 망에서 사용  
 - Router ip   
**Private IP (사설 IP)**
 - 회사 네트워크 망에서 누가나 사용
 - 목적
     - 기업 내부망 보호(보안)
     - 적은 IP로 많은 시스템을 인터넷을 사용 (NAT)
 - 각 클래스별 대역
    - A : 10.X.X.X
    - B : 172.16.X.X ~ 172.31.X.X
    - C : 192.168.X.X
 - 클라우드는 사설 ip. 공인 ip와 매핑을 해서 인터넷 연결 필요.
 - VPN을 이용해서 접속 가능


Subnet Mask
 - Network ID, Host ID 식별하는 식별자
 - IP와 Subnet Mask를 AND 연산 Network ID를 식별
	- IP : 192.168.1.46			11000000.10101000.00000001.....
  
	- Subnet Mask : 255.255.255.0	11111111.11111111.11111111.00000000
  
					------------------------------------------------
          
	- AND연산			11000000.10101000.00000001.00000000

	- 192.168.1.1 : host 확인 ip
	- 192.168.1.255 : broadcast 보낼 때 쓰는 ip

 - Default Subnet Mask(기본 서브넷 마스크)
	- A 클래스 : 255.0.0.0
	- B 클래스 : 255.255.0.0
	- C 클래스 : 255.255.255.0
	- 실무에서는 이런 식으로 표기 잘 X   
Gateway
 - 내부 네트워크와 외부 네트워크를 통신하는 관문
 - Application 레벨의 개념
 - 장비 : Router
 - 라우터 인터페이스에 셋팅되는 IP
 - 라우터 인터페이스의 Subnetmask를 어떻게 설정하느냐에 따라 host 대역을 설정할 수 있음
	- 192.168.1.1 & 255.255.0.0  : 192.168이 Network ID
	- 192.168.1.1 & 255.255.255.0  : 192.168.1이 Network ID  
```
cmd 실행
> ipconfig/all
 ...
 기본 게이트웨이 . . . . . . : 192.168.1.1
 ...
```
 - Router 인터페이스에 설정된 IP
 - Router 밑의 모든 네트워크 장비는 네트워크 IP 동일해야

```
내 IP
	- IP : 192.168.1.46		11000000.10101000.00000001.XXXXXXXX
	- Subnet Mask : 255.255.255.0	11111111.11111111.11111111.00000000
					        ------------------------------------------------   
	- AND연산			11000000.10101000.00000001.00000000
	- 내 ip의 네트워크
					192.168.1.0

목적지
 - 192.168.1.200	<--->	192.168.1.0
	- 본인 네트워크를 찾은 후 동일할 경우 Router 통신 X , 바로 통신	
 - 192.168.3.200	<--->	192.168.1.0
	- Gateway에 보낸 후 외부 네트워크와 통신   
```



## 서브네팅(SubNetting)의 의미와 필요성  
Flat Topology
 - 하나의 Router 인터페이스에 모든 컴퓨터를 연결
 - 하나의 Router - Switch - Hub - hosts
 - broadcast domain 하나, 동일 bandwidth(전송 속도 동일)
 - 단점 : 보안 정책

Subnetworks
 - 관리 용이
 - Router 장비에서 ACL (Access Control List) 관리 가능 : Router Interface 간 통신 접근 관련 정책 할당 가능.

**ClassFull (A, B, C)**
 - 10진법표기 방법
 - 사용시 IP 낭비 심함   
**CIDR (Classless Inter-Domain Routing)**
 - 2진법 표기법
 - IP 최적화 해서 부여해주기 위한 표기 방법
 - 192.168.1.19/24
	- /24 : 24bit 서브넷 마스크를 뜻함.
		- ( 255.255.255.0 ) 이 아닌 ( 11111111. 11111111. 11111111. 00000000 )
	- /16 : 16bit 서브넷 마스크
		- 11111111. 11111111. 00000000. 00000000
	- /25 : 25bit
		- 11111111. 11111111. 11111111. 10000000
		- 255. 255. 255. 128
		- 25bit 까지가 Network ID
		- Host 수 : 2^7 -2 만큼 구성 가능
	- /26 : 11111111. 11111111. 11111111. 11000000 ;	255.255.255.192
	- /27 : 11111111. 11111111. 11111111. 11100000 ;	255.255.255.224
	- /28 : 11111111. 11111111. 11111111. 11110000 ;	255.255.255.240
	- /29 : 11111111. 11111111. 11111111. 11111000 ;	255.255.255.248
	- /30 : 11111111. 11111111. 11111111. 11111100 ;	255.255.255.252
	- /31 : 11111111. 11111111. 11111111. 11111110 ;	255.255.255.254


IP Address 와 Subnet Mask로 알 수 있는 정보
 - 192.168.1.19/22
	
	11000000  10101000 0000001 00010011   
	11111111  11111111 1111100 00000000  
	++++++++++++++++++++++++++  
	11000000  10101000 00000 00 00000000 -> 192.168.0.0  
	11000000  10101000 00000 11 11111111 -> 192.168.11.255   
	
	- Network ID : 192.168.0.0
		- ip, subnet mask를 AND연산 통해 구함
		- Network IP를 제외한 Host IP에 전부 0을 넣은 IP
	- Broadcast IP : 192.168.11.255
		- Network IP를 제외한 Host IP에 전부 1을 넣은 IP
		- Network IP, Broadcast IP는 다른 곳에서 사용하면 X
	- Host 수 : 2^10 -2 ( 1022 ) ; Rouer 인터페이스까지 넣으면 1021개(Router interface도 ip 한 개 필요).  
	- 실제 적용가능한 IP 범위 : 192.168.0.1 ~ 192.168.3.254


<문제> Subnetting 
ISP에서 192.168.0.0/16 부여받음.
4개의 Subnet Network로 분할해서 사용예정.
	


인사부 : 
관리부 : 
영업부 : 
제조부 : 
 - Router interface에서 각각의 부서 할당


VLSM (Variable Length Subnet Mask)
 - 호스트 수에 따라서 Subnet을 나눔  

192.168.1.0/24 <--- ISP 로부터 할당 받음

192.168.1.0
	00000000
인사부 : 120개	; 192.168.1.0/25	; 2^7-2 = 126개; 192.168.1.1 ~192.168.1.126 ( 127은 Broadcast )  

	10000000
관리부 : 60개	; 192.168.1.128/26	; 2^6-2 = 62개; 192.168.1.129 ~ 192.168.1.190 ( 191은 Broadcast )

	11000000
영업부 : 20개  	; 192.168.1.192/27 ; 2^5-2 = 30개; 192.168.1.193 ~ 192.168.1.222

	11100000
제조부 : 10개  	; 192.168.1.224/28 ; 2^4-2 = 14개; 192.168.1.225 ~ 192.168.1.238




```
cmd 실행
> ipconfig /release
> ipconfig /renew
```
 - ipconfig /release : DHCP로부터 받은 ip 삭제
 - ipconfig /renew : DHCP 서버에서 ip 다시 받음

@ DHCP
 - client의 IP / Subnet Mask, Gateway, DNS 값을 할당해줌

@ DNS
 - 영문 URL 을 IP로 변환해주는 서비스
 - 
