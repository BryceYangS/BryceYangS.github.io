---
layout: post
title: "[MSA] CQRS"
subtitle: "cqrs"
categories: study
tags: msa
---
> CQRS 정리

# Why?
- UX, 비즈니스 요구 사항 복잡할 때
- 조회 성능을 보다 높이고 싶을 때
- 데이터 관리 영역 / 뷰 전달 영역 책임 분리
- 시스템 확장성 높이고 싶을 때

# What is CQRS?


# How?
## 변경 감지 방법
- JPA EntityListeners
  - @Entity / @MappedSuperclass 객체 메소드 : 어노테이션 지정 사용 가능
  - 콜백 지정 함수 선언 가능 : @PrePersist, @PostPersist, @PreUpdate, ... 등 7가지
  - @EntityListeners 어노테이션과 함께 callback listener class 구현 가능
  - 해당 엔티티만 인자로 반환 => 엔티티 특정 속성 변경 추적 어려움
- Hibernate EventListener
  - SessionFactoryImpl -> SessionFactoryServiceRegistry -> EventListenerRegistry
  - 26가지 콜백 유형
  - 받고자 하는 상황에 따른 인터페이스 구현 클래스 등록
  - 상세한 정보 전달 (변경 프로퍼티, 이전 상태, 현재 상태 등)
  - 모든 엔티티 변경 사항 전달
- Hibernate Interceptor
  - Session, SessionFactory에 Interceptor 등록
  - 인터셉터이기 때문에 저장될 데이터 조작 가능
- Spring AOP
  - 메서드에만 설정 가능
  - 변경 감지에 있어서 복잡도 높아질 수 있음
- CDC?

# 참조
- [B마트 전시 도메인 CQRS 적용하기](https://www.youtube.com/watch?v=fg5xbs59Lro)
- cqrs 패턴 : https://microservices.io/patterns/data/cqrs.html
- eventuate 다양한 예제 : https://eventuate.io/exampleapps.html
- https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf
- O`reilly > Domain-Driven Design with Java - A Practitioner's Guide : https://learning.oreilly.com/library/view/domain-driven-design-with/9781800560734/B16716_07_Final_NM_ePub.xhtml#_idParaDest-116
- O`reilly > Microservices Patterns (우리 스터디 주교재 286 ~322p.) : https://learning.oreilly.com/library/view/microservices-patterns/9781617294549/OEBPS/Text/07.html
- O`reilly > Learning Domain-Driven Design (우리 스터디 부교재 139 ~148p.) : https://learning.oreilly.com/library/view/learning-domain-driven-design/9781098100124/ch08.html#polyglot_modeling